version: "3.8"

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
      args:
        # This is embedded at build-time into the frontend bundle
        # For local use, keep it pointing to the containerâ€™s exposed port
        APIKA_APP_URL: "http://localhost:8080"
        # Pass OpenAI key at build time for frontend embedding
        OPENAI_API_KEY: "${OPENAI_API_KEY}"
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
      # Pass through sensitive envs at runtime (server reads process.env)
      # Ensure these exist in your shell or via the env_file
      # OPENAI_API_KEY will be read by the backend
    env_file:
      - .env
    command: ["node", "index.js"]
